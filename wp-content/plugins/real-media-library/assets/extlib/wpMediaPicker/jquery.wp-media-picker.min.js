/*! real-media-library 03-05-2018 */

!function(o,a){if(void 0!==window.wp&&void 0!==window.wp.media&&void 0!==window.wp.media.editor){var s=a.media.editor.send.attachment,n=window.send_to_editor,r=function(e){var t=window.wpActiveEditor;document.getElementById(t).innerHTML=e,window.send_to_editor=n};a.media.editor.send.attachment=function(e,t){var n;if(0===(n=a.media.editor.activeEditor?a.media.editor.activeEditor:window.wpActiveEditor||"").search("wp-mediapicker-content-")){var i=n.substring("wp-mediapicker-content-".length);return window.send_to_editor=r,o("#"+i).wpMediaPicker("sendAttachment",t)}return s.apply(this,[e,t])};var e={options:{store:"id",query:{},filterable:"all",searchable:!0,editable:!1,allowLocalEdits:!1,displaySettings:!1,displayUserSettings:!1,change:!1,htmlChange:!1,onClose:!1,onShow:!1,clear:!1,label_add:a.media.view.l10n.addMedia,label_replace:a.media.view.l10n.replace,label_remove:a.media.view.l10n.remove,label_modal:a.media.view.l10n.addMedia,label_button:a.media.view.l10n.addMedia},_create:function(){var e=this;o.extend(e.options,e.element.data()),e.content_id="wp-mediapicker-content-"+e.element.attr("id"),e.element.hide().wrap('<div class="wp-mediapicker-container" />'),e.wrap=e.element.parent(),e.open_button=o('<a class="wp-mediapicker-open-button button" />').insertAfter(e.element),e.remove_button=o('<a class="wp-mediapicker-remove-button" style="cursor:pointer;" />').insertAfter(e.open_button).text(e.options.label_remove),e.content_wrap=o('<div class="wp-mediapicker-content-wrap" />').insertAfter(e.remove_button),e.content=o('<div class="wp-mediapicker-content" />').appendTo(e.content_wrap).attr("id",e.content_id),e.workflow=a.media.editor.add(e.content_id,{frame:"select",state:"insert",states:[new a.media.controller.Library({id:"insert",title:e.options.label_modal,priority:20,toolbar:"select",filterable:e.options.filterable,library:a.media.query(e.options.query),multiple:!1,syncSelection:!0,editable:e.options.editable,allowLocalEdits:e.options.allowLocalEdits,displaySettings:e.options.displaySettings,displayUserSettings:e.options.displayUserSettings})],button:{event:"insert",text:e.options.label_button}}),e.workflow.on("close",function(){"function"==typeof e.options.onClose&&setTimeout(function(){e.options.onClose(e)}.bind(this),100)}.bind(this)),e._updateContent(),e._addListeners()},_addListeners:function(){var t=this;t.open_button.on("click",function(e){e.preventDefault(),t.workflow.state("insert").get("selection").reset(t.attachment?[t.attachment]:[]),t.open(),"function"==typeof t.options.onShow&&setTimeout(function(){t.options.onShow(t)}.bind(this),100)}),t.remove_button.on("click",function(e){e.preventDefault(),t.element.val(null),t._resetContent(),"function"==typeof t.options.clear&&t.options.clear.call(t)})},_createContent:function(e,t){var n=this;n.attachment=e,n.open_button.text(n.options.label_replace),n.remove_button.show();var i="";if("image"===e.type){var o=e.url;e.sizes&&e.sizes.large?o=e.sizes.large.url:e.sizes&&e.sizes.full&&(o=e.sizes.full.url),i+='<img src="'+o+'" alt="'+e.alt+'" />'}else if("video"===e.type){var a="";e.image&&e.image.src!==e.icon&&(a=e.image.src),i+='<video class="wp-video-shortcode" preload="metadata"'+(a?' poster="'+a+'"':"")+' controls><source type="'+e.mime+'" src="'+e.url+'" /></video>'}else"audio"===e.type?(e.image&&e.image.src&&e.image.src!==e.icon?i+='<img class="wp-audio-cover" src="'+e.image.src+'" alt="'+e.filename+'" />':i+='<div class="mime-type-icon"><img src="'+e.icon+'" /><span>'+e.filename+"</span></div>",i+='<audio class="wp-audio-shortcode" width="100%" preload="none" controls><source type="'+e.mime+'" src="'+e.url+'" /></audio>'):i+='<div class="mime-type-icon"><img src="'+e.icon+'" /><span>'+e.filename+"</span></div>";if(0<=i.search("<img ")?n.content.addClass("size-auto"):n.content.removeClass("size-auto"),n.content.show(),t)return"function"==typeof n.options.htmlChange&&setTimeout(function(){n.options.htmlChange(n.content,this)}.bind(this),500),i;n.content.html(i),"function"==typeof n.options.htmlChange&&n.options.htmlChange(n.content,this)},_resetContent:function(){var e=this;e.attachment=null,e.open_button.text(e.options.label_add),e.remove_button.hide(),e.content.hide().empty().removeClass("size-auto"),"function"==typeof e.options.htmlChange&&e.options.htmlChange(e.content,this)},_updateContent:function(){var t=this,e=t.element.val();e?"url"===t.options.store?a.media.ajax({type:"POST",data:{action:"get-attachment-by-url",url:e},success:function(e){t._createContent(e)},error:function(){t.element.val(null),t._resetContent()}}):a.media.ajax({type:"POST",data:{action:"get-attachment",id:parseInt(e,10)},success:function(e){t._createContent(e)},error:function(){t.element.val(null),t._resetContent()}}):(t.element.val(null),t._resetContent())},sendAttachment:function(e){var t=this;"url"===t.options.store?t.element.val(e.url):t.element.val(e.id);var n=t._createContent(e,!0);return"function"==typeof t.options.change&&t.options.change.call(t),n},open:function(){a.media.editor.open(this.content_id)},close:function(){this.workflow.close()},attachment:function(e){if(void 0===e)return this.attachment;e?("url"===this.options.store?this.element.val(e.url):this.element.val(e.id),this._createContent(e)):(this.element.val(null),this._resetContent())},value:function(e){if(void 0===e)return this.attachment?"url"===this.options.store?this.attachment.url:this.attachment.id:"";this.element.val(e),this._updateContent()}};o.widget("wp.wpMediaPicker",e)}else o.fn.wpMediaPicker=function(){return this}}(jQuery,window.wp);